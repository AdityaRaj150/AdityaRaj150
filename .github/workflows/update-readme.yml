name: Update README

on:
  schedule:
    - cron: "0 0 * * *"  # Runs every day at midnight
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt-get install -y jq

      - name: Fetch GitHub Stats
        env:
          GH_USERNAME: "AdityaRaj150"
        run: |
          COMMIT_COUNT=$(curl -s https://api.github.com/users/$GH_USERNAME | jq '.public_repos')
          PR_COUNT=$(curl -s https://api.github.com/search/issues?q=author:$GH_USERNAME+type:pr | jq '.total_count')
          MERGED_COUNT=$(curl -s https://api.github.com/search/issues?q=author:$GH_USERNAME+type:pr+is:merged | jq '.total_count')
          
          # Update README with the fetched stats
          sed -i "s/Commits: .*/Commits: $COMMIT_COUNT/" README.md
          sed -i "s/PRs: .*/PRs: $PR_COUNT/" README.md
          sed -i "s/Merged PRs: .*/Merged PRs: $MERGED_COUNT/" README.md

      - name: Commit and Push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git commit -m "Update README with latest stats"
          git push
